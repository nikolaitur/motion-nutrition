class Uppromote{constructor(e="production",t=!0){this.env=e,this.host=({dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://track.uppromote.com"})[e]||"https://track.uppromote.com",this.cdnHost=({dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://d1639lhkj5l89m.cloudfront.net"})[e]||"https://d1639lhkj5l89m.cloudfront.net",this.cdnS3Host=({dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://cdn.uppromote.com"})[e]||"https://cdn.uppromote.com",this.cache=t}init(){this.processOnLoadPage(),this.uppromoteLog("Running...")}assetS3(e=""){let t=this.cdnS3Host;return e.startsWith("http")?e:("production"!==this.env&&(t=`${t}/storage`),`${t}/${e=(e=e.replace("//","/")).startsWith("/")?e.slice(1,e.length):e}`)}renderElm(e="div",t,r={},o){let s=document.createElement(e);return t&&(Array.isArray(t)?t.map(e=>s.classList.add(e)):t&&0!==t.length&&s.classList.add(t)),Object.keys(r).forEach(e=>s.setAttribute(e,r[e])),o&&(s.innerHTML=o),s}async fetchAndGetContent(e="",t="GET",r={}){if(r.shopify_domain=this.getShopDomain(),["GET","HEAD"].includes(t)){e=new URL(e);let o=new URLSearchParams(r),s=e.searchParams,n=new URLSearchParams({...Object.fromEntries(o),...Object.fromEntries(s)});e=`${e.origin}${e.pathname}?${n.toString()}`;let a=await fetch(e);return await a.json()||null}{let i=new FormData;Object.keys(r).forEach(e=>i.append(e,r[e]));let c=await fetch(e,{method:t,headers:{},body:i});return await c.json()||null}}setCookie(e,t,r){let o=new Date;o.setTime(o.getTime()+864e5*r);let s="expires="+o.toUTCString();document.cookie=e+"="+t+";"+s+";path=/"}getCookie(e){let t=e+"=",r=decodeURIComponent(document.cookie).split(";");for(let o=0;o<r.length;o++){let s=r[o];for(;" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return""}mustPostClickTracking(e){if(!e)return!0;let t=new Date().getTime();return t-e>6e4}checkResponseFromServer(){if("false"===localStorage.getItem("scaaf_received")){let e=this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid");e&&this.postClickTracking({aid:e,tid:localStorage.getItem("scaaf_tid"),hc:localStorage.getItem("scaaf_hc"),s:this.getShopName(),ug:navigator.userAgent},null,()=>{uppromote.uppromoteLog("ReTracking success!")})}}parseQueryStringToObject(e=""){try{let t=new URLSearchParams(e),r=t.entries(),o={};for(let[s,n]of r)o[s]=n;return o}catch(a){return{}}}getShopDomain(){try{if(Shopify)return Shopify.shop;return""}catch(e){return console.error("Uppromote: getShopName() - Error when get shopify domain"),""}}getShopName(){return this.getShopDomain().replace(".myshopify.com","")}getShopifyCheckoutObject(){return Shopify&&Shopify.checkout?Shopify.checkout:null}getShopifyCheckoutInformationObject(){return Shopify&&Shopify.Checkout?Shopify.Checkout:null}copyToClipboard(e,t){e.focus(),e.select(),navigator.clipboard.writeText(e.value).then(t)}applyDiscountCode(e){let t=this.renderElm("iframe","sca_d-none",{src:`/discount/${e}`});t.style.display="none",document.body.append(t)}getMessageBarSetting(){return"undefined"!=typeof SCAAFMessageBar?SCAAFMessageBar:null}initFbPixel(){let e=this.renderElm("script","sca_aff_fb_pixel_init");e.textContent='!function(a,c,b,d,e,f,g){a.fbq||(e=a.fbq=function(){e.callMethod?e.callMethod.apply(e,arguments):e.queue.push(arguments)},!a._fbq&&(a._fbq=e),e.push=e,e.loaded=!0,e.version="2.0",e.queue=[],f=c.createElement(b),f.async=!0,f.src=d,g=c.getElementsByTagName(b)[0],g.parentNode.insertBefore(f,g))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");',document.head.append(e)}getCouponCode(e,t){let r=`${this.host}/api/get_coupon`,o=e||this.getCookie("scaaf_aid");o&&this.fetchAndGetContent(r,"GET",{aid:o}).then(e=>{"ok"===e.status?(uppromote.applyDiscountCode(e.coupon),setTimeout(()=>{t&&(window.location.href=`${t}&discount=${e.coupon}`)},200)):t&&(window.location.href=t)}).catch(()=>{t&&(window.location.href=t)})}trackFbPixel(e){let t=`${this.host}/api/get_fb_pixel`,r={aff_id:e||this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid"),shop:`${this.getShopDomain()}`},o=function(e){let t=uppromote.getShopifyCheckoutObject(),r=uppromote.getShopifyCheckoutInformationObject();fbq("init",e),fbq("trackSingle",e,"PageView"),t&&fbq("trackSingle",e,"Purchase",{value:t.total_price,currency:t.currency}),r&&"contact_information"===r.step&&fbq("trackSingle",e,"InitiateCheckout",{currency:t.currency,value:t.estimatedPrice}),document.location.pathname.startsWith("/cart")&&fbq("trackSingle",e,"AddToCart")};r.aff_id&&this.fetchAndGetContent(t,"GET",r).then(e=>{"ok"===e.status&&o(e.pixel)}).catch(e=>{console.error("Uppromote: trackFbPixel() - Error when fetch Fb pixel"),console.error(e)})}appendAffiliateIdToRegisterForm(e=null){let t=window.location.pathname.split("/")[2]||"";if("register"!==t||!(e=e||this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid")))return;let r=document.querySelector('form[method="post"][action*="account"]');if(!r)return;let o=this.renderElm("input",null,{type:"hidden",name:"customer[note][affiliate_id]",value:e});r.append(o)}getPostPurchasePopupSetting(){let e=`${this.host}/api/purchase_popup/setting`,t=this.getShopifyCheckoutObject();if(!t||!t.email)return;let r={email:t.email,shop:this.getShopDomain()};this.fetchAndGetContent(e,"GET",r).then(e=>{"ok"===e.status&&uppromote.renderPostPurchasePopup(e)})}renderPostPurchasePopup(e){if(this.getCookie("sca_p_p_show_once")&&1===e.settings.show_only_once)return;1===e.settings.show_only_once&&this.setCookie("sca_p_p_show_once",1,360);let t=e.settings,r=t.design,o=t.promotion_method,s=t.custom_css,n=e.customize,a=`${this.cdnHost}/css/script_tag/script_affiliate.css`,i=this.renderElm("link",null,{href:`${a}${this.cache?"":`?v=${new Date().getTime()}`}`,rel:"stylesheet"}),c=this.renderElm("style",null,{},s);document.head.append(i,c);let f=this.renderElm("div","sca_purchase_popup_modal_container"),l=this.renderElm("div",["sml","is-open"],{id:"modal-1","aria-hidden":"false"}),u=this.renderElm("div","sca_modal_overlay",{id:"sca_modal_overlay",tabindex:"-1","data-micromodal-close":""}),p=this.renderElm("div","sca_modal_container",{id:"modal_container",role:"dialog","aria-modal":"true","aria-labelledby":"modal-1-title"}),m=this.renderElm("button",["sca_modal_close","x-btn"],{"aria-label":"Close modal","data-micromodal-close":"",id:"sca_post_purchase_popup_close_button"},"x"),d=this.renderElm("div",null,{id:"sca_popup"}),h=this.renderElm("div","sca_modal_image",{alt:"Post purchase popup"}),g="none"===r.header_image?this.cdnHost+"/img/default_popup.jpg":this.assetS3(r.header_image);"/img/default_popup.jpg"===r.header_image&&(g=this.cdnHost+"/img/default_popup.jpg"),h.style.backgroundImage=`url(${g})`,h.style.height=`${r.image_height}px`;let C=this.renderElm("div",null,{id:"sca_main"}),k=this.renderElm("div",null,{id:"sca_content"}),v=this.renderElm("div",null,{id:"sca_title"},r.title);v.style.color=r.title_color;let A=this.renderElm("div",null,{id:"sca_subtitle"},2===o?r.sub_title_coupon:r.sub_title),R,b;if(n){R=this.renderElm("div","scaaff_require_term"),b=this.renderElm("input",null,{type:"checkbox",id:"confirm-term",name:"confirm-term"});let y=this.renderElm("label",null,{for:"confirm-term"},`I agree with <a href="${n.term}" target="_blank">Terms and Conditions</a>`);R.append(b,y)}let E=this.renderElm("div","sca_result_wrapper",{id:"sca_result_wrapper"}),I=2===o?r.button_text_coupon:r.button_text,w=this.renderElm("button",null,{id:"sca_reg_mode_manual_btn","data-origin-text":I},I);w.style.cursor=n?"not-allowed":"pointer",w.style.backgroundColor=r.button_background,w.style.color=r.button_text_color,w.style.borderRadius=`${r.button_border_radius}px`;let S=this.renderElm("div","sca_share_container",{id:"sca_share"}),$=function(){l.setAttribute("aria-hidden","true"),setTimeout(()=>{f.style.display="none"},300)},T=function(){n&&(w.style.cursor=b.checked?"pointer":"not-allowed",w.disabled=!b.checked)},x=function(){n?b.checked&&uppromote.postRegisterAffiliatePostPurchasePopup():uppromote.postRegisterAffiliatePostPurchasePopup()};w.append(S),E.append(w),k.append(v,A),R&&k.append(R),k.append(E),C.append(k),d.append(h,C,S),p.append(m,d),u.append(p),l.append(u),f.append(l),document.body.append(f),m.addEventListener("click",$),1===t.close_background_click&&document.addEventListener("click",function(e){e.target===u&&$()}),R&&b&&b.addEventListener("change",T),w.addEventListener("click",x)}postRegisterAffiliatePostPurchasePopup(){let e=document.getElementById("sca_reg_mode_manual_btn"),t=document.getElementById("sca_result_wrapper");if(!e&&!t)return;let r=function(t=!0){e.disabled=t,e.style.cursor=t?"not-allowed":"pointer",e.textContent=t?"Loading...":e.dataset.originText},o=this.getShopifyCheckoutObject();if(!o||!o.email)return;let s=function(e){let r=uppromote.renderElm("div","result_wrapper"),o=uppromote.renderElm("div","input-link-wrapper"),s=uppromote.renderElm("input","sca_ip",{id:"sca_referral_link_ip",type:"text",value:e.coupon_code||e.referral_link}),n=e.coupon_code?"Copy coupon":"Copy link",a=uppromote.renderElm("button",["sca_bt","sca_btn_copy"],{id:"sca_popup_copy_btn"},n);o.append(s),r.append(o,a),t.innerHTML="",t.append(r),a.addEventListener("click",()=>{uppromote.copyToClipboard(s,()=>{a.textContent="Copied!",setTimeout(()=>{a.textContent=n},1e3)})});let i={facebook:{title:"Share on Facebook",img:`${uppromote.cdnHost}/img/facebook.svg`,shareUrl:"https://www.facebook.com/sharer.php?u="},twitter:{title:"Share on Twitter",img:`${uppromote.cdnHost}/img/twitter.svg`,shareUrl:"https://twitter.com/intent/tweet?url="},pinterest:{title:"Share on Pinterest",img:`${uppromote.cdnHost}/img/pinterest.svg`,shareUrl:"https://pinterest.com/pin/create/link/?url="},linkedin:{title:"Share on LinkedIn",img:`${uppromote.cdnHost}/img/linkedin.svg`,shareUrl:"https://www.linkedin.com/shareArticle?mini=true&url="}},c=document.getElementById("sca_share");for(let f in i){let l=uppromote.renderElm("a",null,{target:"_blank",title:i[f].title,href:`${i[f].shareUrl}${e.referral_link}`}),u=uppromote.renderElm("img",null,{alt:i[f].title,src:i[f].img});l.append(u),c.append(l)}c.style.display="block"},n=function(e){let t=e.message,o=document.querySelector("#sca_popup #sca_content"),s=o.querySelector("#sca_subtitle"),n=o.querySelector("#sca_post_purchase_error");n&&n.remove(),n=uppromote.renderElm("p","sca_post_purchase_error",{id:"sca_post_purchase_error"},t),t&&o&&s.after(n),r(!1)},a={email:o.email,first_name:o.billing_address.first_name,last_name:o.billing_address.last_name,shop:this.getShopDomain()},i=this.getCookie("scaaf_aid")||localStorage.getItem("scaaf_aid"),c=o.discount?o.discount.code:null;i&&(a.affiliate_id=i),c&&(a.coupon=c),r(),this.fetchAndGetContent(`${this.host}/api/post_affiliate_purchase`,"POST",a).then(e=>{"ok"===e.status?s(e):n(e)})}renderMessageBar(){if(parseInt(scaAffCustomerRefer.getCookie("scaaf_is_program_customer")))return;let e=document.querySelector(".scaaf-message-bar");e&&e.remove();let t=this.getMessageBarSetting();if(!t)return;let r={name:this.getCookie("scaaf_afn")||"",first_name:this.getCookie("scaaf_affn")||"",company:this.getCookie("scaaf_afc")||"",personal_detail:this.getCookie("scaaf_pd")||""},o="Arial|Helvetica+Neue|Courier+New|Times+New+Roman|Comic+Sans+MS|Impact".split("|"),s=e=>{let t=this.renderElm("link",null,{href:`https://fonts.googleapis.com/css?family=${e}`,rel:"stylesheet",type:"text/css"});document.head.append(t)};if((()=>{let e=`${this.cdnHost}/css/script_tag/script_affiliate_message_bar.css`,t=this.renderElm("link",null,{href:this.cache?e:e+`?v=${new Date().getTime()}`,rel:"stylesheet",type:"text/css"});document.head.append(t)})(),1===t.referral_enable){if(r.name){(()=>{if(!t.referral_content)return;let e=t.referral_font.replace(/\+/g," ").split(":");s(t.referral_font);let o=this.renderElm("div","scaaf-message-bar"),n=this.renderElm("p","scaaf-message-bar-content");o.style.backgroundColor=t.referral_background_color,n.style.color=t.referral_text_color,n.style.fontSize=t.referral_font_size+"px",n.style.fontFamily=`"${e[0]}", sans-serif`,n.textContent=t.referral_content.replace("{affiliate_name}",r.name).replace("{company}",r.company).replace("{affiliate_firstname}",r.first_name).replace("{personal_detail}",r.personal_detail),o.append(n),document.body.prepend(o)})();return}1===t.not_referral_enable&&(()=>{if(!t.not_referral_content)return;let e=t.not_referral_font.replace(/\+/g," ").split(":");-1===o.indexOf(t.not_referral_font)&&s(t.not_referral_font);let r=this.renderElm("div","scaaf-message-bar"),n=this.renderElm("p","scaaf-message-bar-content");r.style.backgroundColor=t.not_referral_background_color,n.style.color=t.not_referral_text_color,n.style.fontSize=t.not_referral_font_size+"px",n.style.fontFamily=`"${e[0]}", sans-serif`,n.textContent=t.not_referral_content,r.append(n),document.body.prepend(r)})()}}postClickTracking(e,t,r){localStorage.getItem("scaaf_sca_source_secomus")&&(e.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/click_tracking`,"POST",e).then(o=>{if("ok"===o.status){this.uppromoteLog(`Tracking affiliate id ${e.aid}`),this.setLocalTrackingReceivedVariables(o),this.getCouponCode(),scaAffCustomerRefer.setCustomerReferralState(1,o.program_id),r&&r(o),this.runCustomizePostClickTrackingCallback(o);return}t&&clearInterval(t),scaAffCustomerRefer.setCustomerReferralState(0,null),r&&r(o)}).catch(e=>{t&&clearInterval(t),scaAffCustomerRefer.setCustomerReferralState(0,null),r&&r(e),console.warn(e)})}postCheckoutToken(){let e=this.getShopifyCheckoutObject(),t=this.getShopifyCheckoutInformationObject();if(!t||!t.token||!e)return;let r={aid:localStorage.getItem("scaaf_aid"),ct_tk:t.token,s:this.getShopName(),hc:localStorage.getItem("scaaf_hc"),order_id:e.order_id};localStorage.getItem("scaaf_sca_source_secomus")&&(r.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/ct_tk`,"POST",r).then(()=>{}).catch(e=>{console.error(e)})}postCartToken(e,t){e.ug=navigator.userAgent,localStorage.getItem("scaaf_sca_source_secomus")&&(e.sca_source=localStorage.getItem("scaaf_sca_source_secomus")),this.fetchAndGetContent(`${this.host}/api/ctk`,"POST",e).then(r=>{if("ok"===r.status){this.setCookie("scaaf_tid",r.tid,360),localStorage.setItem("scaaf_tid",r.tid),localStorage.setItem("scaaf_ctk",e.ctk),this.setCookie("scaaf_ctk",e.ctk,360),localStorage.setItem("scaaf_received","true");return}clearInterval(t)}).catch(e=>{clearInterval(t),console.error(e)})}processOnLoadPage(){let e=this.parseQueryStringToObject(window.location.search.substring(1));if(e.sca_ref){let t=e.sca_ref.split("."),r={aid:t[0],hc:t[1],s:this.getShopName(),tid:localStorage.getItem("scaaf_tid"),ug:navigator.userAgent},o=localStorage.getItem("scaaf_c_c"),s=new Date().getTime();this.setLocalTrackingVariables(r.aid,!1,r.hc,s,e.sca_source),this.mustPostClickTracking(o)?this.postClickTracking(r,null):this.renderMessageBar(),e.sca_rib&&(this.getCookie("scaaf_aid")?this.getCouponCode(r.aid,e.sca_rib):window.location.href=e.sca_rib)}else this.checkResponseFromServer(),this.renderMessageBar(),this.getCouponCode();this.intervalCheckCartToken(),this.postCheckoutToken(),this.appendAffiliateIdToRegisterForm(),this.getPostPurchasePopupSetting(),this.initFbPixel(),setTimeout(()=>uppromote.trackFbPixel(),200)}setLocalTrackingVariables(e,t=!1,r,o,s){localStorage.setItem("scaaf_aid",e),localStorage.setItem("scaaf_received",t?"true":"false"),localStorage.setItem("scaaf_hc",r),localStorage.setItem("scaaf_c_c",o),this.setCookie("scaaf_aid",e,360),this.setCookie("scaaf_c_c",o,360),s&&(localStorage.setItem("scaaf_sca_source_secomus",s||""),this.setCookie("scaaf_sca_source_secomus",s||"",360))}setLocalTrackingReceivedVariables(e={}){localStorage.setItem("scaaf_received","true"),localStorage.setItem("scaaf_tid",e.tid),localStorage.setItem("scaaf_ep",(1e3*e.ep).toString()),this.setCookie("scaaf_tid",e.tid,360),this.setCookie("scaaf_ep",1e3*e.ep,360),this.setCookie("scaaf_afn",e.afd.affiliate_name||"",e.afcookie),this.setCookie("scaaf_afc",e.afd.company||"",e.afcookie),this.setCookie("scaaf_affn",e.afd.affiliate_firstname||"",e.afcookie),this.setCookie("scaaf_pd",e.afd.personal_detail||"",e.afcookie)}intervalCheckCartToken(){let e=()=>{let e=localStorage.getItem("scaaf_ctk"),r=this.getCookie("cart");if(!r)return;let o=localStorage.getItem("scaaf_tid"),s=localStorage.getItem("scaaf_aid");if(o&&s){let n=localStorage.getItem("scaaf_ep");if(n&&n<new Date().getTime()){clearInterval(t);return}if(e!==r){let a=this.getShopifyCheckoutObject();if(a){clearInterval(t);return}this.postCartToken({aid:localStorage.getItem("scaaf_aid"),tid:localStorage.getItem("scaaf_tid"),ctk:r,s:this.getShopName()},t)}}"false"===localStorage.getItem("scaaf_received")&&this.postClickTracking({aid:localStorage.getItem("scaaf_aid"),tid:localStorage.getItem("scaaf_tid"),hc:localStorage.getItem("scaaf_hc"),s:this.getShopName(),ug:navigator.userAgent},t)},t=setInterval(e,1e3)}runCustomizePostClickTrackingCallback(e){if("function"==typeof scaAffClickTrackingCallback)try{scaAffClickTrackingCallback(e)}catch(t){console.log(t)}}uppromoteLog(e){console.log(`%c â–º Uppromote Affiliate Marketing: (${e})`,"background-color: #FF4141; color: #fff; padding: 5px;")}}class SCAAFFCustomerRefer{constructor(e="production"){this.env=e,this.host=({dev:"https://secomapp-affiliate.test",test:"https://af-test.uppromote.com",production:"https://track.uppromote.com"})[e]||"https://track.uppromote.com",this.setting=null,this.referContainer=null,this.referIcon=null,this.closeButtonIcon=null,this.inviteContainer=null,this.inviteContentContainer=null,this.errorText=null,this.closeButton=null,this.inviteEmailInput=null,this.getInviteLinkButton=null,this.closeShopNowButton=null,this.shopNowContainer=null,this.shopNowOverlayContainer=null,this.uiComponents={}}init(){let e=setInterval(()=>{"undefined"!=typeof SCAAFFCustomerReferSetting&&(clearInterval(e),uppromote.uppromoteLog("Customer referral running"),scaAffCustomerRefer.setting=SCAAFFCustomerReferSetting,scaAffCustomerRefer.setting.program.active&&(this.renderReferCustomer(),this.addEventListener(),this.checkRegisterStatus()))},500);setTimeout(()=>{clearInterval(e)},1e4)}addEventListener(){scaAffCustomerRefer.referContainer&&(scaAffCustomerRefer.referIcon.addEventListener("click",scaAffCustomerRefer.onReferButtonClicked),scaAffCustomerRefer.closeButton.addEventListener("click",scaAffCustomerRefer.onReferButtonClicked),scaAffCustomerRefer.getInviteLinkButton.addEventListener("click",scaAffCustomerRefer.submitRegister),scaAffCustomerRefer.closeButtonIcon.addEventListener("click",scaAffCustomerRefer.onCloseIconButton))}addShopNowPopupEventListener(){scaAffCustomerRefer.closeShopNowButton&&(scaAffCustomerRefer.closeShopNowButton.addEventListener("click",function(e){scaAffCustomerRefer.onCloseShopNowButtonClicked(e)}),scaAffCustomerRefer.shopNowOverlayContainer.addEventListener("click",function(e){scaAffCustomerRefer.onCloseShopNowButtonClicked(e)}),scaAffCustomerRefer.uiComponents.shopNowButton.addEventListener("click",function(e){scaAffCustomerRefer.onCloseShopNowButtonClicked(e)}))}checkRegisterStatus(){let e=scaAffCustomerRefer.getCookie("scaaf_refer_customer_link");e&&(scaAffCustomerRefer.applyInviteLink(e),scaAffCustomerRefer.setRegisterState(e))}renderReferCustomer(){if(this.closedInviteIcon())return;let e=scaAffCustomerRefer.renderCustomerReferContainer(),t=scaAffCustomerRefer.renderReferIcon(),r=scaAffCustomerRefer.renderCloseInviteButton(),o=scaAffCustomerRefer.renderInviteContainer(),s=scaAffCustomerRefer.renderCloseButton(),n=scaAffCustomerRefer.renderInviteContentContainer(),a=scaAffCustomerRefer.renderInviteHeader(),i=scaAffCustomerRefer.renderInviteContent(),c=scaAffCustomerRefer.renderInviteInputContainer(),f=scaAffCustomerRefer.renderInviteInput(),l=scaAffCustomerRefer.renderInviteInputAddon(),u=scaAffCustomerRefer.renderErrorContainer();t.append(r),c.append(l,f),n.append(a,i,c,u),o.append(s,n),e.append(o,t),document.body.append(e)}renderShopNowPopup(){let e=this.renderShopNowOverlay(),t=this.renderShopNowContainer(),r=this.renderCloseShopNowButton(),o=this.renderShopNowHeader(),s=this.renderShopNowContent(),n=this.renderShopNowButton();scaAffCustomerRefer.uiComponents.shopNowButton=n,t.append(r,o,s,n),e.append(t),document.body.append(e)}onReferButtonClicked(){let e="fadeInUp",t="fadeOutDown",r=scaAffCustomerRefer.referContainer.dataset.webPosition;"none"===getComputedStyle(scaAffCustomerRefer.inviteContainer).display?(r.includes("-bottom")&&(e="fadeInUp"),(r.includes("-center")||r.includes("-top"))&&(e="fadeInDown"),scaAffCustomerRefer.inviteContainer.style.animationName=e,setTimeout(()=>{scaAffCustomerRefer.inviteContainer.style.display="block"},100)):(r.includes("-bottom")&&(t="fadeOutDown"),(r.includes("-center")||r.includes("-top"))&&(t="fadeOutUp"),scaAffCustomerRefer.inviteContainer.style.animationName=t,setTimeout(()=>{scaAffCustomerRefer.inviteContainer.style.display="none"},500))}onCloseShopNowButtonClicked(e){let t=e.target.classList;(t.contains("sca_aff_customer_refer_shop_now_overlay")||t.contains("sca_aff_customer_refer_close_shop_now_button")||t.contains("sca_aff_customer_refer_shop_now_button"))&&(scaAffCustomerRefer.shopNowContainer.style.animationName="fadeOutUp",scaAffCustomerRefer.shopNowOverlayContainer.style.animationName="fadeOut",setTimeout(()=>{scaAffCustomerRefer.shopNowOverlayContainer.style.display="none"},500))}submitRegister(){if(this.hasAttribute("data-created-affiliate"))scaAffCustomerRefer.copyInviteLink();else{let e=scaAffCustomerRefer.inviteEmailInput.value;if(!scaAffCustomerRefer.isValidEmail(e)){scaAffCustomerRefer.errorText.textContent="Please enter a valid email address",scaAffCustomerRefer.errorText.style.display="block";return}scaAffCustomerRefer.setRegisteringStateButton(),scaAffCustomerRefer.postRegister(e)}}onCloseIconButton(){scaAffCustomerRefer.referContainer.remove(),sessionStorage.setItem("closed_refer_customer","1")}postRegister(e){let t=scaAffCustomerRefer.setting.program.shop;uppromote.fetchAndGetContent(`${scaAffCustomerRefer.host}/api/refer-customer/register`,"POST",{email:e,shop:t}).then(e=>{scaAffCustomerRefer.errorText.style.display="none",e.error?(scaAffCustomerRefer.errorText.textContent=e.error,scaAffCustomerRefer.errorText.style.display="block"):(scaAffCustomerRefer.applyInviteLink(e.data),scaAffCustomerRefer.setRegisterState(e.data)),scaAffCustomerRefer.setRegisteringStateButton(!1)})}processCustomerReferLink(){scaAffCustomerRefer.setting.program.active&&scaAffCustomerRefer.isCustomerReferLink()&&(scaAffCustomerRefer.renderShopNowPopup(),scaAffCustomerRefer.addShopNowPopupEventListener(),scaAffCustomerRefer.applyDiscountCode())}closedInviteIcon(){return!!sessionStorage.getItem("closed_refer_customer")}isValidEmail(e){return/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,7})+$/.test(e)}setRegisterState(e){scaAffCustomerRefer.setCookie("scaaf_refer_customer_link",e,365)}setCookie(e,t,r){let o=new Date;o.setTime(o.getTime()+864e5*r);let s="expires="+o.toUTCString();document.cookie=e+"="+t+";"+s+";path=/"}getCookie(e){let t=e+"=",r=decodeURIComponent(document.cookie).split(";");for(let o=0;o<r.length;o++){let s=r[o];for(;" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return""}isCustomerReferLink(){try{let e=window.location.search,t=new URLSearchParams(e),r=!1;return t.get("sca_ref")&&t.get("sca_crp")&&parseInt(atob(this.setting.program.program))===parseInt(atob(t.get("sca_crp")))&&(r=!0),r}catch(o){return console.error("Cant base64 decode customer refer program id"),!1}}setCustomerReferralState(e,t){let r=function(){try{let r=parseInt(t),o=parseInt(atob(scaAffCustomerRefer.setting.program.program));r===o?(e&&scaAffCustomerRefer.processCustomerReferLink(),scaAffCustomerRefer.setCookie("scaaf_is_program_customer",1,30),uppromote.renderMessageBar()):(scaAffCustomerRefer.setCookie("scaaf_is_program_customer",0,30),uppromote.renderMessageBar())}catch(s){console.error(s)}},o=function(){scaAffCustomerRefer.setCookie("scaaf_is_program_customer",0,30),uppromote.renderMessageBar()};scaAffCustomerRefer.waitForSetting(r,o)}waitForSetting(e,t){let r=!1,o=function(){scaAffCustomerRefer.setting&&(clearInterval(n),e(),r=!0)},s=function(){clearInterval(n),!r&&t&&t()},n=setInterval(o,500);setTimeout(s,1e3)}setRegisteringStateButton(e=!0){e?(scaAffCustomerRefer.getInviteLinkButton.setAttribute("disabled",""),scaAffCustomerRefer.getInviteLinkButton.style.cursor="wait",scaAffCustomerRefer.inviteEmailInput.setAttribute("disabled","")):(scaAffCustomerRefer.getInviteLinkButton.removeAttribute("disabled"),scaAffCustomerRefer.getInviteLinkButton.style.cursor="pointer",scaAffCustomerRefer.inviteEmailInput.removeAttribute("disabled"))}applyInviteLink(e){scaAffCustomerRefer.getInviteLinkButton.removeAttribute("disabled"),scaAffCustomerRefer.getInviteLinkButton.setAttribute("data-created-affiliate","true"),scaAffCustomerRefer.getInviteLinkButton.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_copy_invite,scaAffCustomerRefer.inviteEmailInput.type="text",scaAffCustomerRefer.inviteEmailInput.value=e,scaAffCustomerRefer.inviteEmailInput.setAttribute("readonly",""),scaAffCustomerRefer.inviteContentContainer.append(this.renderShareContainer(e))}copyInviteLink(){scaAffCustomerRefer.inviteEmailInput.focus(),scaAffCustomerRefer.inviteEmailInput.select(),navigator.clipboard.writeText(scaAffCustomerRefer.inviteEmailInput.value).then(()=>{scaAffCustomerRefer.getInviteLinkButton.textContent="Copied!",setTimeout(()=>{scaAffCustomerRefer.getInviteLinkButton.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_copy_invite},1e3)})}renderElm(e="div",t,r={}){let o=document.createElement(e);return t&&(Array.isArray(t)?t.map(e=>o.classList.add(e)):t&&0!==t.length&&o.classList.add(t)),Object.keys(r).forEach(e=>o.setAttribute(e,r[e])),o}renderCustomerReferContainer(){return this.referContainer=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_container",{"data-web-position":scaAffCustomerRefer.setting.design.refer_customer_button.web_position,"data-mobile-position":scaAffCustomerRefer.setting.design.refer_customer_button.mobile_position}),this.referContainer}renderReferIcon(){let e=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_button");scaAffCustomerRefer.referIcon=e;let t=scaAffCustomerRefer.renderElm("img",["sca_aff_customer_refer_icon"],{src:"https://cdn.uppromote.com/storage/feature-banner/gift.svg",alt:"Customer Referral"}),r=scaAffCustomerRefer.renderElm("span");return r.textContent=scaAffCustomerRefer.setting.design.refer_customer_button.refer_button_text,e.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_button.refer_background_color,e.style.color=scaAffCustomerRefer.setting.design.refer_customer_button.refer_text_color,e.prepend(t,r),e}renderCloseInviteButton(){let e=scaAffCustomerRefer.renderElm("span","sca_aff_customer_refer_close_icon_button");return this.closeButtonIcon=e,e.innerHTML="&times;",e}renderInviteContainer(){let e=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_container");return scaAffCustomerRefer.inviteContainer=e,e}renderCloseButton(){let e=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_close_button",{type:"button"});return e.innerHTML="&times;",scaAffCustomerRefer.closeButton=e,e}renderInviteContentContainer(){let e=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_contents");return this.inviteContentContainer=e,e}renderInviteHeader(){let e=scaAffCustomerRefer.renderElm("h1","sca_aff_customer_refer_invite_header");return e.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_header,e}renderInviteContent(){let e=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_invite_content");return e.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_description,e}renderInviteInputContainer(){return scaAffCustomerRefer.renderElm("div","sca_aff_custom_invite_inputs")}renderInviteInputAddon(){let e=scaAffCustomerRefer.renderElm("input","sca_aff_custom_invite_input",{type:"email",name:"sca_customer_refer_email",id:"sca_customer_refer_email",placeholder:"Your email address"});return scaAffCustomerRefer.inviteEmailInput=e,e}renderErrorContainer(){let e=this.renderElm("p","sca_aff_customer_invite_error");return this.errorText=e,e}renderShareContainer(e){e=encodeURIComponent(e);let t=this.renderElm("div","sca_aff_customer_invite_share_container"),r=this.renderElm("a",null,{href:`https://facebook.com/sharer/sharer.php?u=${e}`,target:"_blank"}),o=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/facebook.svg",alt:"facebook"}),s=this.renderElm("a",null,{href:`https://twitter.com/intent/tweet/?text=&url=${e}`,target:"_blank"}),n=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/twitter.svg",alt:"twitter"}),a=this.renderElm("a",null,{href:`https://pinterest.com/pin/create/button/?url=${e}`,target:"_blank"}),i=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/pinterest.svg",alt:"pinterest"}),c=this.renderElm("a",null,{href:`https://www.linkedin.com/shareArticle?mini=true&url=${e}&title=&summary=&source=${e}`,target:"_blank"}),f=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/linkedin.svg",alt:"linkedin"}),l=this.renderElm("a",null,{href:`https://reddit.com/submit/?url=${e}`,target:"_blank"}),u=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/reddit.svg",alt:"reddit"}),p=this.renderElm("a",null,{href:`mailto:?subject=&body=${e}`,target:"_blank"}),m=this.renderElm("img",null,{src:"https://cdn.uppromote.com/storage/uploads/icons/mail.svg",alt:"mail"});return r.append(o),s.append(n),a.append(i),c.append(f),l.append(u),p.append(m),t.append(r,s,a,c,l,p),t}renderInviteInput(){let e=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_invite_button");return e.textContent=scaAffCustomerRefer.setting.design.refer_customer_invite.button_text_get_invite,e.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_background_color,e.style.color=scaAffCustomerRefer.setting.design.refer_customer_invite.popup_text_color,scaAffCustomerRefer.getInviteLinkButton=e,e}applyDiscountCode(){if("none"!==scaAffCustomerRefer.setting.program.incentive.type){let e=this.renderElm("iframe","sca_aff_customer_refer_discount_iframe");e.style.display="none";let t=scaAffCustomerRefer.setting.program.incentive.coupon;e.src=`/discount/${t}`,document.body.append(e)}}renderShopNowOverlay(){let e=this.renderElm("div","sca_aff_customer_refer_shop_now_overlay");return this.shopNowOverlayContainer=e,e}renderShopNowContainer(){let e=this.renderElm("div","sca_aff_customer_refer_shop_now_container");return this.shopNowContainer=e,e}renderCloseShopNowButton(){let e=scaAffCustomerRefer.renderElm("button","sca_aff_customer_refer_close_shop_now_button",{type:"button"});return e.innerHTML="&times;",scaAffCustomerRefer.closeShopNowButton=e,e}renderShopNowHeader(){let e=scaAffCustomerRefer.renderElm("h2","sca_aff_customer_refer_shop_now_header");return e.textContent=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_header,e}renderShopNowContent(){let e=scaAffCustomerRefer.renderElm("div","sca_aff_customer_refer_shop_now_content");return e.textContent=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_description,e}renderShopNowButton(){let e=scaAffCustomerRefer.renderElm("a","sca_aff_customer_refer_shop_now_button",{href:"#"});return e.innerHTML=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_button_text,e.style.backgroundColor=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_background_color,e.style.color=scaAffCustomerRefer.setting.design.refer_customer_incentive_popup.shop_text_color,scaAffCustomerRefer.shopNowButton=e,e}}const uppromote=new Uppromote("production"),scaAffCustomerRefer=new SCAAFFCustomerRefer("production");uppromote.init(),scaAffCustomerRefer.init();